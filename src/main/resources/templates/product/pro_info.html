<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<th:block layout:fragment="content">

  <style>
    :root{
      --page-bg:#0f172a; --text:#f1f5f9; --muted:#cbd5e1;
      --card-bg:rgba(255,255,255,.10); --card-br:rgba(148,163,184,.35);
      --shadow:0 18px 48px rgba(2,6,23,.55);
      --btn-grad:linear-gradient(135deg,#7dd3fc,#a78bfa);
      --chip-bg:rgba(148,163,184,.12); --chip-br:rgba(148,163,184,.35);
      --danger:#ef4444; --success:#34d399;
      --focus:#7cc0ff;
    }
    body{background:var(--page-bg); color:var(--text);}
    a, a:hover{ text-decoration:none; }

    .card-glass{ background:var(--card-bg); border:1px solid var(--card-br); box-shadow:var(--shadow); border-radius:16px; overflow:hidden; }
    .page-header{ display:flex; flex-direction:column; gap:6px; margin:24px 0 16px; position:relative; }
    .page-title{ margin:0; font-weight:800; letter-spacing:.2px; background:var(--btn-grad); -webkit-background-clip:text; background-clip:text; color:transparent; font-size:2rem; }

    .chip-container{ display:flex; flex-wrap:wrap; gap:6px; margin-top:4px; }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:.28rem .6rem; border-radius:999px; background: linear-gradient(135deg, #7dd3fc66, #a78bfa66); border: 1px solid #a78bfa; color: #fff; font-weight: 600; font-size:0.85rem; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); }
    .chip span:first-child{ font-size:1rem; }

    .gallery-main{ position:relative; border-bottom:1px solid var(--card-br); }
    .gallery-main img{ width:100%; height:365px; object-fit:cover; display:block; }
    .gallery-main::after{ content:""; position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.35), rgba(0,0,0,0) 50%); pointer-events:none; }
    .thumbs{ display:flex; gap:8px; padding:10px; overflow:auto; }
    .thumbs img{ width:78px; height:78px; object-fit:cover; border-radius:10px; border:1px solid var(--card-br); cursor:pointer; transition:transform .15s; }
    .thumbs img:hover{ transform:scale(1.03); }
    .thumbs img.selected{ border-color:#7dd3fc; transform:scale(1.05); }

    .price-row{ display:flex; align-items:baseline; gap:10px; flex-wrap:wrap; font-size:1rem; }
    .original{ color:#9ca3af; text-decoration:line-through; font-size:.98rem; }
    .discounted{ color:var(--danger); font-weight:800; font-size:1.4rem; }
    .save{ color:var(--success); font-weight:700; font-size:.95rem; }
    .discount-label{ background:var(--danger); color:#fff; font-weight:800; font-size:.85rem; border-radius:999px; padding:.18rem .55rem; margin-left:10px; }

    .btn-grad{ background:var(--btn-grad); color:#0b1020; border:0; font-weight:800; }
    .btn-outline{ background:transparent; color:var(--text); border:1px solid var(--card-br); }
    .btn-grad, .btn-outline{ padding:.7rem 1rem; border-radius:12px; display:inline-flex; align-items:center; gap:8px; }
    .btn-outline:hover{ border-color:var(--focus); }

    .divider{ height:1px; background:var(--card-br); margin:12px 0; border-radius:999px; }

    @media (max-width: 992px){ .gallery-main img{ height:300px; } }
  </style>

  <div class="container mt-3 mb-4">

    <!-- íƒ€ì´í‹€/ì¹© -->
    <div class="page-header">
      <h1 class="page-title h3" th:text="${productVo.pro_name != null ? productVo.pro_name : 'ìƒí’ˆëª… ì—†ìŒ'}">ì—…ì²´ëª…</h1>

      <!-- ì—…ì²´ëª… ë°”ë¡œ ì•„ë˜: ì§€ì—­/í…Œë§ˆ/í›„ê¸° ì¹© -->
      <div class="chip-container">
        <span th:if="${productVo.cate_name != null}" class="chip">
          <span>ğŸ—ºï¸</span>
          <span th:text="${productVo.cate_name}">ì§€ì—­ëª…</span>
        </span>

        <span th:each="themeName : ${productVo.themeList}" class="chip">
          <span>ğŸ“Œ</span>
          <span th:text="${themeName}">í…Œë§ˆëª…</span>
        </span>

        <span class="chip">
          <span>ğŸ’¬</span>
          ì´ìš©í›„ê¸° <strong th:text="${productVo.pro_review != null ? productVo.pro_review : 0}">0</strong>ê±´
        </span>
      </div>
    </div>

    <div class="row g-3">
      <!-- Left: Gallery -->
      <div class="col-12 col-lg-6">
        <div class="card-glass">
          <div class="gallery-main">
            <img id="mainImage"
                 th:src="@{'/product/image_display?dateFolderName=' + (${productVo.pro_up_folder}) + '&fileName=' + ${mainImage}}"
                 th:alt="${productVo.pro_name != null ? productVo.pro_name : 'ìƒí’ˆ ì´ë¯¸ì§€'}">
          </div>

          <div class="thumbs">
            <img th:each="img : ${images}"
                 th:src="@{'/product/image_display?dateFolderName=' + ${img.img_folder} + '&fileName=' + ${img.img_name}}"
                 th:alt="${productVo.pro_name != null ? productVo.pro_name + ' ì´ë¯¸ì§€' : 'ì´ë¯¸ì§€'}"
                 th:classappend="${img.img_name == mainImage} ? 'selected' : ''"
                 onclick="switchImage(this)">
            <span th:if="${images == null or #lists.isEmpty(images)}">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
          </div>
        </div>
      </div>

      <!-- Right: Info -->
      <div class="col-12 col-lg-6">
        <div class="card-glass p-3">

          <!-- ëŒ€í‘œ ìš”ê¸ˆ -->
          <div class="price-row" style="align-items:center; gap:10px;">
            <span style="font-weight:600;">ëŒ€í‘œ ìš”ê¸ˆ</span>
            <span class="discounted" th:text="${#numbers.formatInteger((productVo.pro_price != null ? productVo.pro_price : 0) - ((productVo.pro_price != null ? productVo.pro_price : 0) * productVo.pro_discount / 100), 3, 'COMMA') + 'ì›'}">77,000ì›</span>
            <span class="discount-label"
                  th:if="${productVo.pro_discount != null and productVo.pro_discount > 0}"
                  th:text="${productVo.pro_discount + '% OFF'}">30% OFF</span>
          </div>

          <div class="price-row">
            <span class="original" th:text="${#numbers.formatInteger(productVo.pro_price != null ? productVo.pro_price : 0, 3, 'COMMA') + 'ì›'}">110,000ì›</span>
            <span class="save" th:text="${'(-' + #numbers.formatInteger((productVo.pro_price != null ? productVo.pro_price : 0) * productVo.pro_discount / 100, 3, 'COMMA') + 'ì› í• ì¸)'}">(-33,000ì› í• ì¸)</span>
          </div>

          <div class="divider"></div>

          <!-- ì—°ë½ì²˜ ë°•ìŠ¤ -->
          <div style="margin-bottom:12px;">
            <label class="form-label fw-bold" style="display:inline-flex; align-items:center; gap:6px; margin-right:12px;">
			    <span>ì—°ë½ì²˜ :</span>
			    <span th:text="${productVo.pro_telephone != null ? productVo.pro_telephone : '01000000000'}">01000000000</span>
			</label>
            <a class="btn-outline" th:href="${productVo.pro_telephone != null ? 'tel:' + productVo.pro_telephone : '#'}"
            style="display:inline-flex; align-items:center; gap:4px;">
              	<span>ğŸ“</span>
    			<span>ì „í™” ë¬¸ì˜</span>
            </a>
          </div>

          <div class="divider"></div>
          
        <!-- ì£¼ì†Œ -->
		<div class="mb-3 col-md-12">
		    <label class="form-label fw-bold" style="display:inline-flex; align-items:center; gap:4px;">
		    	<span>ğŸ“</span>
    			<span>ì—…ì²´ ìœ„ì¹˜</span>
		    </label>
		    <p class="form-control-plaintext" style="color:white;">
		        <span><span th:text="${productVo.pro_addr}">ê¸°ë³¸ì£¼ì†Œ</span>,
		        <span th:text="${productVo.pro_deaddr}">ìƒì„¸ì£¼ì†Œ</span></span>
		    </p>
		</div>
          
          <div class="divider"></div>

          <!-- ì—…ì²´ ì†Œê°œ ë²„íŠ¼ -->
		<a class="btn-outline" href="#tab-desc"
		   onclick="scrollToSection('tab-desc'); return false;" style="width:fit-content; display:inline-flex; align-items:center; gap:4px;">
			<span>â„¹ï¸</span>
    		<span>ì—…ì²´ ì†Œê°œ</span>
		</a>
		
		<!-- ì´ìš© í›„ê¸° ë²„íŠ¼ -->
		<a class="btn-outline" href="#tab-reviews"
		   onclick="scrollToSection('tab-reviews'); return false;" 
		   style="width:fit-content; display:inline-flex; align-items:center; gap:4px;">
		  	<span>â­</span>
    		<span>ì´ìš© í›„ê¸°</span>
		</a>

      </div>
    </div>
  </div>

    <!-- ì—…ì²´ ì†Œê°œ ì¶œë ¥ ì˜ì—­ -->
    <div id="tab-desc" class="card-glass p-3 mt-4">
      <h3 style="display:inline-flex; align-items:center; gap:6px;">
	  	<span>ğŸ”–</span>
		<span th:text="'ì—…ì²´ ì†Œê°œ'">ì—…ì²´ ì†Œê°œ</span>
	  </h3>
      <div th:utext="${productVo.pro_content}">
        ì—…ì²´ ì†Œê°œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
    
    <!-- Right ì»¬ëŸ¼ ë°”ê¹¥, í˜ì´ì§€ ì „ì²´ í­ -->
	<div id="tab-reviews" class="card-glass p-3 mt-4">
	  <h3 style="display:inline-flex; align-items:center; gap:6px;">
	  	<span>ğŸ’¬</span>
		<span th:text="'ì´ìš© í›„ê¸°'">ì´ìš© í›„ê¸°</span>
	  </h3>
	
	  <!-- í›„ê¸° ì‘ì„± í¼ -->
	  <form id="reviewForm" method="post" th:action="@{/review/add_review}">
	    <input type="hidden" name="pro_num" th:value="${productVo.pro_num}">
	    <div class="mb-3">
	      <label for="reviewerName" class="form-label fw-bold">ì‘ì„±ì</label>
	    </div>
	    <div class="mb-3">
	      <label for="reviewContent" class="form-label fw-bold">í›„ê¸° ë‚´ìš©</label>
	      <textarea class="form-control" id="reviewContent" name="rev_content" rows="4" required></textarea>
	    </div>
	    <button type="submit" class="btn btn-grad">í›„ê¸° ì‘ì„±</button>
	  </form>
	
	  <hr>
	
	  	<!-- í›„ê¸° ë¦¬ìŠ¤íŠ¸ -->
		<div id="reviewList">
		  <div th:each="review : ${productVo.reviewList}" class="mb-2 p-2 card-glass">
		    <!-- í›„ê¸° ì‘ì„±ì/ë‚´ìš©/ì‘ì„±ì¼ -->
		    <strong th:text="${review.mbsp_id}">ì‘ì„±ì</strong>
		    <p th:text="${review.rev_content}">í›„ê¸° ë‚´ìš©</p>
		    <small th:text="${#temporals.format(review.rev_date, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</small>
		
		    <!-- í›„ê¸°ë³„ ë‹µë³€ ë°˜ë³µ -->
		    <div th:each="reply : ${review.replies}" style="margin-left:1rem; margin-top:4px;">
		      <p>
		        <b th:text="${reply.manager_id}">ê´€ë¦¬ì</b>:
		        <span th:text="${reply.reply_text}">ë‹µë³€ ë‚´ìš©</span>
		        <small th:text="${#temporals.format(reply.reply_date, 'yyyy-MM-dd HH:mm')}">ë‹µë³€ì¼</small>
		      </p>
		    </div>
		
		    <!-- ë‹µë³€ ë“±ë¡ í¼ -->
			<form th:action="@{/review/add_reply}" method="post" style="margin-top:6px;">
			    <input type="hidden" name="rev_code" th:value="${review.rev_code}" />
			    <input type="hidden" name="pro_num" th:value="${productVo.pro_num}" /> <!-- ì´ ì¤„ ì¶”ê°€ -->
			    <input type="text" name="reply_text" placeholder="ë‹µë³€ ì‘ì„±" required />
			    <button type="submit" class="btn btn-grad btn-sm">ë“±ë¡</button>
			</form>

		  </div>
		
		  <span th:if="${#lists.isEmpty(productVo.reviewList)}">ì‘ì„±ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
		</div>
	  
	</div>
	
  </div>

  <script th:inline="javascript">
    function switchImage(el){
      const src = el.getAttribute('src');
      const main = document.getElementById('mainImage');
      if(!src || !main) return;
      main.setAttribute('src', src);
      document.querySelectorAll('.thumbs img').forEach(img => img.classList.remove('selected'));
      el.classList.add('selected');
    }

    function toggleWish(btn){
      const active = btn.classList.toggle('is-wished');
      if(active){
        btn.style.borderColor = '#f472b6';
        btn.style.color = '#f472b6';
      }else{
        btn.style.borderColor = 'var(--card-br)';
        btn.style.color = 'var(--text)';
      }
    }
    
    function scrollToSection(id){
    	  const target = document.getElementById(id);
    	  if(!target) return;
    	  const offset = 100; // ì›í•˜ëŠ” margin-top ê°’
    	  const top = target.getBoundingClientRect().top + window.scrollY - offset;
    	  window.scrollTo({ top: top, behavior: 'smooth' });
   	}

  </script>

</th:block>
</html>
